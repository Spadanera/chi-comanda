files:
  "/etc/nginx/conf.d/https.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      server {
        listen 443 ssl;
        server_name chicomanda.it;

        ssl_certificate /etc/pki/tls/certs/your_certificate.pem; # Replace with the path to your certificate file
        ssl_certificate_key /etc/pki/tls/private/your_certificate.key; # Replace with the path to your private key file

        ssl_protocols TLSv1.2 TLSv1.3;
        ssl_ciphers HIGH:!aNULL:!MD5;

        location / {
          proxy_pass http://localhost:8080; # Or your application's port
          proxy_set_header Host $host;
          proxy_set_header X-Real-IP $remote_addr;
          proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
          proxy_set_header X-Forwarded-Proto $scheme;
        }
      }

commands:
  01_create_cert_dir:
    command: "mkdir -p /etc/pki/tls/certs /etc/pki/tls/private"
  02_fetch_cert:
    command: "aws acm get-certificate --certificate-arn arn:aws:acm:us-east-1:088055566159:certificate/603b06de-ad40-41ef-8322-47d9810489cc --query 'CertificateChain' --output text > /etc/pki/tls/certs/your_certificate.pem"
  03_fetch_key:
    command: "aws acm get-certificate --certificate-arn arn:aws:acm:us-east-1:088055566159:certificate/603b06de-ad40-41ef-8322-47d9810489cc --query 'PrivateKey' --output text > /etc/pki/tls/private/your_certificate.key"